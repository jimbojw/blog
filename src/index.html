<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- with reckless abandon -->
<title>jimbojw</title>
<!--style type="text/css"-->
<link rel="stylesheet" type="text/css" href="css/style.css" />
<!--/style-->
</head>
<!--[if lt IE 9 ]><body class="oldie"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><body><!--<![endif]-->
<!--html-->
<div class="container">
<header>
	<h1 class="logo">
		<a href="/" title="jimbojw" class="logo">
			<span>jimbojw</span>
		</a>
	</h1>
</header>
<nav>
	<form action="/find" method="get">
		<p class="find">
			<label>
				<input type="text" name="q" />
				<button><span>go</span></button>
			</label>
		</p>
	</form>
</nav>
<article>
<div class="article">
	<header>
		<h2>
			<a href="/articles/architects_love_a_code_chameleon" title="Architects love a code chameleon">
				<span>Architects love a code chameleon</span>
			</a>
		</h2>
	</header>
<p>
Software architects, or those who aspire to become them, love code chameleons.
</p>
<p>
A code chameleon is a coder who can format their code in such a way that it looks, for all intents and purposes, like the architect had written it.
</p>
<p>
Being a code chameleon isn't hard, just take note to follow:
</p>
<ul>
<li><span>spacing conventions (tabs vs spaces vs mix),</span></li>
<li><span>variable naming conventions (hungarian, camel case, underscored),</span></li>
<li><span>scoping conventions (in some languages),</span></li>
<li><span>class and method naming conventions (capitalization),</span></li>
<li><span>protection conventions (public/private/protected - in some lanugages),</span></li>
<li><span>testing conventions (unit tests, integration tests, etc).</span></li>
</ul>
<p>
There is a difference between following the conventions (written or implicit) and personal style.  It's good to develop a personal style, and the code you write for the architect can differ from the code you write for yourself.
</p>
</div>
</article>
<article>
<div class="article">
	<header>
		<h2>
			<a href="/articles/history_cookies" title="History cookies">
				<span>History cookies</span>
			</a>
		</h2>
	</header>
<section>
<h3><span>Idea</span></h3>
<p>
Use the browser's history to store predictable cookie data.
</p>
<p>
Prior art: [JavaScript Visited Link Scanner](http://www.gnucitizen.org/blog/javascript-visited-link-scanner/)
</p>
</section>
<section>
<h3><span>Storing data</span></h3>
<p>
Suppose each visitor is given an alphanumeric cookie for session tracking. 5 characters for simplicity.
</p>
<p>
A user visits the site and is issued the cookie value <code>ABCDE</code>.
</p>
<p>
The page contains JavaScript code which:
</p>
<ol>
<li><span>reads the session cookie;</span></li>
<li><span>constructs a series of urls of the form <code>http://server/#A</code>, <code>http://server/#AB</code>, <code>http://server/#ABC</code>, etc;</span></li>
<li><span>creates a hidden <code>iframe</code>; and</span></li>
<li><span>systematically sets the iframe's <code>src</code> attribute to each of the aforementioned URLs.</span></li>
</ol>
<p>
The result is that the browser now treats links to <code>#A</code>, <code>#AB</code>, etc as "visited" links, assigning them the color purple by default.
</p>
</section>
<section>
<h3><span>Retreiving data</span></h3>
<p>
To retrieve the session cookie from the history, we effectively search for the "visited" links sequentially.
</p>
<p>
The JavaScript code to do this will:
</p>
<ol>
<li><span>create an invisible <code>iframe</code> with <code>src</code> set to <code>about:blank</code>;</span></li>
<li><span>create a set of urls of the form <code>http://server/#A</code>, <code>http://server/#B</code>, etc, one for each possible first character;</span></li>
<li><span>in the iframe's DOM, create anchor tags for each url;</span></li>
<li><span>iterate through the urls, looking for the first purple one;</span></li>
<li><span>when the purple is found, note the character at the end, then create a new set of urls for the second character and set all the anchor <code>href</code> attributes;</span></li>
<li><span>iterate throught the urls again, looking for the first purple one to find the second character;</span></li>
<li><span>then repeat until the entire session id is determined.</span></li>
</ol>
</section>
<section>
<h3><span>Fragility</span></h3>
<p>
The system described is interesting in its novelty, but it's fairly fragile.  Clearing the browser's history will eliminate the information.
</p>
<p>
Further, an attacker could easily seed a user's history using the link following scheme defined above, effectively prepping the victim to piggyback on a known session the next time they visit the site.  And if a CSRF vulnerability can be found on the site, history cookies would make it that much easier to exploit.
</p>
</section>
<section>
<h3><span>Cost</span></h3>
<p>
The cost of storing the data is one extra hit to the server root, providing it doesn't perform any redirection.  Subsequent <code>#X</code> linking should not cause a page refresh within the iframe.  The number of DOM manipulations grows linearly with id length.
</p>
<p>
The cost of retreiving the data is DOM manipulation and color checking.  No additional round-trips should be made.  On average, the number of checks will equal <code>n</code> * <code>m/2</code> where <code>n</code> is the nubmer of digits, and <code>m</code> is the size of the character set.  In the example outlined above, this is 5 * 36 / 2 = 90.  In the worst case it'll be twice this number.
</p>
</section>
<section>
<h3><span>Example implementation</span></h3>
<p>
Should probably go in evil.js.
</p>
</section>
</div>
</article>
<aside>
<div class="aside">
	<a href="/about" title="Jim R. Wilson">
	<figure>
		<p><img src="http://d1eqzjbvoh1rux.cloudfront.net/image/jim-r-wilson.jpg" alt="Jim R. Wilson" /></p>
		<figcaption><span>Jim R. Wilson</span></figcaption>
	</figure>
	</a>
</div>
</aside>
<footer>
<p class="footer">Copyright &#xA9; 2010 Jim R. Wilson (jimbojw)</p>
</footer>
</div>
<!--/html-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://d1eqzjbvoh1rux.cloudfront.net/raphael-min-1.5.2.js"></script>
<!--script-->
<script type="text/javascript" src="js/graphics.js"></script>
<!--/script-->
</body>
</html>
